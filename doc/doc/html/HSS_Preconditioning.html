<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BUTTERFLYPACK v@PROJECT_VERSION@: HSS Preconditioning</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="../custom-style/my_customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname" style="font-family: silom;"><a href="#"><img src="logo.png" style="height:80px"></a>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('HSS_Preconditioning.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">HSS Preconditioning </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >The sparse multifrontal solver can optionally use Hierarchically Semi-Separable, rank-structured matrices to compress the fill-in. In the multifrontal method, computations are performed on dense matrices called frontal matrices. A frontal matrix can be approximated as an HSS matrix, but this will only be beneficial (compared to storing the frontal as a standard dense matrix and operating on it with BLAS/LAPACK routines) if the frontal matrix is large enough.</p>
<div class="image">
<img src="SPOptions_Interface.png" alt="" width="18%"/>
</div>
<p ><b>Figure 3</b> illustrates the HSS matrix format. The matrix is partitioned as a 2x2 block matrix, with the partitioning recursively applied on the diagonal blocks, until diagonal blocks are smaller than a specified leaf size. The off-diagonal block on each level of the hierarchy are approximated by a low-rank product. This low-rank storage format asymptotically reduces memory usage and floating point operations, while introducing approximation errors. HSS compression is not used by default in the STRUMPACK sparse solver (the default is to perform exact LU factorization), but can be turned on/off via the command line:</p>
<div class="fragment"><div class="line">--sp_compression hss</div>
<div class="line">--sp_compression none    (disable HSS)</div>
</div><!-- fragment --><p >or via the C++ API as follows</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> strumpack::SPOptions::set_compression(CompressionType::HSS);</div>
<div class="line"><span class="keywordtype">void</span> strumpack::SPOptions::set_compression(CompressionType::NONE);</div>
<div class="line">CompressionType strumpack::SPOptions::compression() <span class="keyword">const</span>;  <span class="comment">// get compression type (none/hss/blr/hodlr)</span></div>
</div><!-- fragment --><p >When compression is enabled, the default STRUMPACK behavior is to use the approximate LU factorization as a preconditioner within GMRES. This behavior can also be changed, see <a class="el" href="">Solve</a>.</p>
<p >However, HSS compression has a considerable overhead and only pays off for sufficiently large matrices. Therefore STRUMPACK has a tuning parameter to specify the minimum size a dense matrix needs to be to be considered a candidate for HSS compression. The minimum dense matrix size for HSS compression is set via the command line via</p>
<div class="fragment"><div class="line">--sp_compression_min_sep_size int</div>
</div><!-- fragment --><p >or via the C++ API as follows</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> strumpack::SPOptions::set_compression_min_sep_size(<span class="keywordtype">int</span> s);</div>
<div class="line"><span class="keywordtype">int</span> strumpack::SPOptions::compression_min_sep_size() <span class="keyword">const</span>;</div>
</div><!-- fragment --><p >The routine <a class="el" href="">set_compression_min_sep_size(int s)</a> refers to the size of the top-left block of the front only. This top-left block is the part that corresponds to a separator, as given by the nested dissection reordering algorithm. This top-left block is also referred to as the block containing the fully-summed variables. Factorization (LU in the dense case, ULV in the HSS case) is only applied to this top-left block. <b>Tuning the value for the minimum separator size can have a big impact on performance and memory usage!</b></p>
<p >The above options affect the use of HSS within the multifrontal solver. There are more, HSS specific, options which are stored in an object of type <a class="el" href="">HSS::HSSOptions&lt;scalar&gt;</a>. An object of this type is stored in the <a class="el" href="">SPOptions&lt;scalar&gt;</a> object stored in the <a class="el" href="">StrumpackSparseSolver</a>. It can be accessed via the HSS_options() routine as follows:</p>
<div class="fragment"><div class="line">strumpack::StrumpackSparseSolver&lt;double&gt; sp;        <span class="comment">// create solver object</span></div>
<div class="line">sp.options().set_compression(CompressionType::HSS); <span class="comment">// enable HSS compression in the multifrontal solver</span></div>
<div class="line">sp.options().HSS_options().set_leaf_size(256);      <span class="comment">// set the HSS leaf size</span></div>
</div><!-- fragment --><p >In STRUMPACK, HSS matrices are constructed using a randomized sampling algorithm [6]. To construct an HSS approximation for a matrix A, sampling of the rows and columns of A is computed by multiplication with a tall and skinny random matrix R as follows: S^r = AR and S^c = A^*R. Ideally, the number of columns in the matrix R is d = r + p, with r the maximum off-diagonal block rank in the HSS matrix and p a small oversampling parameter. Unfortunately, the HSS rank is not known a-priori, so it needs to determined adaptively. The adaptive sampling scheme used in STRUMPACK starts with an initial number of random vector d_0, and increases this in steps of \Delta d, until the compression quality reaches the desired user specified tolerance, or until the maximum rank is reached. <b>The compression tolerances can greatly impact performance.</b> They can be set using:</p>
<div class="fragment"><div class="line">--hss_rel_tol real (<span class="keywordflow">default</span> 0.01)</div>
<div class="line">--hss_abs_tol real (<span class="keywordflow">default</span> 1e-08)</div>
</div><!-- fragment --><p >or via the C++ API</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> strumpack::HSS::HSSOptions&lt;scalar&gt;::set_rel_tol(real rel_tol);</div>
<div class="line"><span class="keywordtype">void</span> strumpack::HSS::HSSOptions&lt;scalar&gt;::set_abs_tol(real abs_tol);</div>
<div class="line">real strumpack::HSS::HSSOptions&lt;scalar&gt;::rel_tol() <span class="keyword">const</span>;              <span class="comment">// get the current value</span></div>
<div class="line">real strumpack::HSS::HSSOptions&lt;scalar&gt;::abs_tol() <span class="keyword">const</span>;</div>
</div><!-- fragment --> <hr  />
<p >Other options are available to tune for instance the initial number of random vectors d_0, the increment \Delta d, the random number generator or the random number distribution. See the documentation of <a class="el" href="">HSSOptions&lt;scalar&gt;</a> for more detailed information. The corresponding HSS specific command line options are:</p>
<div class="fragment"><div class="line"># HSS Options:</div>
<div class="line">#   --hss_rel_tol real_t (default 0.01)</div>
<div class="line">#   --hss_abs_tol real_t (default 1e-08)</div>
<div class="line">#   --hss_leaf_size int (default 128)</div>
<div class="line">#   --hss_d0 int (default 128)</div>
<div class="line">#   --hss_dd int (default 64)</div>
<div class="line">#   --hss_p int (default 10)</div>
<div class="line">#   --hss_max_rank int (default 5000)</div>
<div class="line">#   --hss_random_distribution normal|uniform (default normal(0,1))</div>
<div class="line">#   --hss_random_engine linear|mersenne (default minstd_rand)</div>
<div class="line">#   --hss_compression_algorithm original|stable|hard_restart (default stable)</div>
<div class="line">#   --hss_clustering_algorithm natural|2means|kdtree|pca|cobble (default 2means)</div>
<div class="line">#   --hss_user_defined_random (default false)</div>
<div class="line">#   --hss_approximate_neighbors int (default 64)</div>
<div class="line">#   --hss_ann_iterations int (default 5)</div>
<div class="line">#   --hss_enable_sync (default true)</div>
<div class="line">#   --hss_disable_sync (default false)</div>
<div class="line">#   --hss_log_ranks (default false)</div>
<div class="line">#   --hss_verbose or -v (default false)</div>
<div class="line">#   --hss_quiet or -q (default true)</div>
<div class="line">#   --help or -h</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.14-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="prec.html">Preconditioners</a></li>
    <li><a href="https://github.com/pghysels/STRUMPACK">STRUMPACK on Github</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
